import{_ as B,p as E,z as F,s as J,o as l,c as n,j as a,aj as j,an as q,a0 as K,a as h,t as P,J as T,e as D,G as U,y as r,U as C}from"./chunks/framework.DkZ_CT3H.js";import{s as G}from"./chunks/melolo.DVL6vrbg.js";import{D as L}from"./chunks/theme.DsE5OG0E.js";const z={class:"search-form"},A={class:"search-input-wrapper"},R=["disabled"],Y={key:0,class:"fas fa-spinner fa-spin"},$={key:1,class:"fas fa-search"},H={key:0,class:"loading-state"},Q={key:1,class:"error-state"},W={key:2},X={key:0,class:"loading-more"},Z={key:1,class:"no-more"},b="drama-search-state",ee={__name:"SearchForm",setup(M){const o=r(""),s=r([]),d=r(!1),f=r(!1),p=r(null),i=r(!0),v=r(0),g=r(!1),_=r(null);let c=null,m=null;E(()=>{const t=sessionStorage.getItem(b);if(t)try{const e=JSON.parse(t);o.value=e.query||"",s.value=e.results||[],i.value=e.hasMore!==void 0?e.hasMore:!0,v.value=e.nextOffset||0,g.value=e.searched||!1}catch(e){console.warn("Failed to restore search state",e)}});function O(){const t={query:o.value,results:s.value,hasMore:i.value,nextOffset:v.value,searched:g.value};sessionStorage.setItem(b,JSON.stringify(t))}function w(){c&&c.disconnect(),_.value&&(c=new IntersectionObserver(t=>{t[0].isIntersecting&&i.value&&!f.value&&I()},{threshold:.1}),c.observe(_.value))}F(_,t=>{t&&C(w)},{immediate:!0}),J(()=>{c&&c.disconnect(),m&&clearTimeout(m)});function N(){m&&clearTimeout(m),m=setTimeout(()=>{y()},300)}async function y(){o.value.trim()&&await k(0,!1)}async function k(t=0,e=!1){e?f.value=!0:(d.value=!0,s.value=[],i.value=!0,v.value=0),p.value=null,g.value=!0;try{const u=await G(o.value,6,t),x=(u.data?.search_data||[]).flatMap(V=>V.books||[]);e?s.value.push(...x):s.value=x,i.value=u.data?.has_more||!1,v.value=u.data?.next_offset||0}catch(u){p.value=u.message}finally{d.value=!1,f.value=!1,O()}}let S=null;const I=()=>{!i.value||f.value||(S&&clearTimeout(S),S=setTimeout(()=>{k(v.value,!0)},100))};return(t,e)=>(l(),n(U,null,[a("div",z,[a("div",A,[e[1]||(e[1]=a("i",{class:"fas fa-search search-icon"},null,-1)),j(a("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>o.value=u),onInput:N,onKeyup:K(y,["enter"]),placeholder:"Search dramas..."},null,544),[[q,o.value]])]),a("button",{onClick:y,disabled:d.value||!o.value.trim()},[d.value?(l(),n("i",Y)):(l(),n("i",$)),e[2]||(e[2]=a("span",{class:"search-text"},"Search",-1))],8,R)]),d.value&&!s.value.length?(l(),n("div",H,[...e[3]||(e[3]=[a("i",{class:"fas fa-spinner fa-spin"},null,-1),h(" Searching... ",-1)])])):p.value&&!s.value.length?(l(),n("div",Q,[e[4]||(e[4]=a("i",{class:"fas fa-exclamation-circle"},null,-1)),h(" Error: "+P(p.value),1)])):(l(),n("div",W,[T(L,{dramas:s.value},null,8,["dramas"]),a("div",{ref_key:"sentinel",ref:_,class:"sentinel"},null,512),f.value?(l(),n("div",X,[...e[5]||(e[5]=[a("i",{class:"fas fa-spinner fa-spin"},null,-1),h(" Loading more... ",-1)])])):D("",!0),!i.value&&s.value.length?(l(),n("div",Z,[...e[6]||(e[6]=[a("i",{class:"fas fa-check-circle"},null,-1),h(" No more results ",-1)])])):D("",!0)]))],64))}},ae=B(ee,[["__scopeId","data-v-342182ec"]]),oe=JSON.parse('{"title":"Search Dramas","description":"","frontmatter":{"title":"Search Dramas"},"headers":[],"relativePath":"search.md","filePath":"search.md"}'),se={name:"search.md"},ie=Object.assign(se,{setup(M){return(o,s)=>(l(),n("div",null,[s[0]||(s[0]=a("h1",{id:"search-dramas",tabindex:"-1"},[h("Search Dramas "),a("a",{class:"header-anchor",href:"#search-dramas","aria-label":"Permalink to “Search Dramas”"},"​")],-1)),T(ae)]))}});export{oe as __pageData,ie as default};
