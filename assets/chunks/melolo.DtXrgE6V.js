const n="https://melolo-api-azure.vercel.app/api",i=["https://api.codetabs.com/v1/proxy?quest=","https://thingproxy.freeboard.io/fetch/","https://api.allorigins.win/raw?url="];async function s(e,a={}){for(const t of i)try{let o,r;if(t.includes("allorigins")){if(o=`${t}${encodeURIComponent(e)}`,r=await fetch(o,a),!r.ok)throw new Error(`HTTP ${r.status}`);const l=await r.json();try{return JSON.parse(l.contents)}catch{return l.contents}}else{if(o=`${t}${e}`,r=await fetch(o,a),!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}}catch(o){console.warn(`Proxy ${t} failed:`,o)}throw new Error("All proxies failed")}function c(e){if(!e)return null;try{const a=e.replace(/\s/g,"");return atob(a)}catch(a){return console.error("Base64 decode error:",a,"for string:",e),null}}async function u(e=0){const a=`${n}/melolo/latest?offset=${e}`;return s(a)}async function d(e=0){const a=`${n}/melolo/trending?offset=${e}`;return s(a)}async function f(e,a=10,t=0){const o=`${n}/melolo/search?query=${encodeURIComponent(e)}&limit=${a}&offset=${t}`;return s(o)}async function p(e){const a=`${n}/melolo/detail/${e}`;return s(a)}async function m(e){const a=`${n}/melolo/stream/${e}`,t=await s(a);if(t.data?.main_url&&(t.data.main_url=c(t.data.main_url)),t.data?.backup_url&&(t.data.backup_url=c(t.data.backup_url)),t.data?.video_model)try{const o=JSON.parse(t.data.video_model);o.video_list&&Object.values(o.video_list).forEach(r=>{r.main_url&&(r.main_url=c(r.main_url)),r.backup_url_1&&(r.backup_url_1=c(r.backup_url_1))}),t.data.video_model=o}catch(o){console.warn("Failed to parse video_model",o)}return t}export{u as a,d as b,m as c,p as g,f as s};
