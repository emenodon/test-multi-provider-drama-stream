import{_ as R,p as Y,s as J,z as K,o as p,c as m,t as h,aj as E,ak as D,j as l,a as I,G as X,H as Z,an as $,e as ee,y as n,h as N,U as ae}from"./framework.PewqAF30.js";import{c as te}from"./melolo.DVL6vrbg.js";const le={key:0},oe={key:1},ne={class:"ep-numbers"},se=["disabled"],ie={class:"episode-indicator"},ue=["disabled"],re=["value"],de=["src"],ve={__name:"WatchDrama",props:{vid:{type:String,default:null},episodes:{type:Array,default:()=>[]}},emits:["update:vid"],setup(U,{emit:P}){const i=U,W=P,_=n(!0),y=n(null),g=n(""),M=n([]),r=n(""),o=n(null),u=n(!0),d=n(null),v=n(!1);let k=0,T=!1;const c=N(()=>{const e=i.episodes.findIndex(a=>a.vid===i.vid);return e===-1?0:e}),q=N(()=>c.value>0),V=N(()=>c.value<i.episodes.length-1);Y(()=>{v.value=window.matchMedia("(hover: hover)").matches,v.value?s(2e3):u.value=!0,S(i.vid)}),J(()=>{d.value&&clearTimeout(d.value)}),K(()=>i.vid,e=>{e&&S(e)});function b(){d.value&&(clearTimeout(d.value),d.value=null)}function s(e=2e3){v.value&&(b(),d.value=setTimeout(()=>{u.value=!1},e))}function L(){v.value&&(u.value=!0,s())}function j(){v.value&&(u.value=!0,s())}async function S(e){if(!e){y.value="No video ID provided",_.value=!1;return}_.value=!0,y.value=null;try{const t=(await te(e)).data||{};if(t.video_model&&t.video_model.video_list){const F=t.video_model.video_list,w=Object.entries(F).map(([x,f])=>({label:f.definition,url:f.main_url,quality:f.definition,bitrate:f.bitrate})).filter(x=>x.url).sort((x,f)=>{const G=parseInt(x.label)||0,O=parseInt(f.label)||0;return G-O});if(M.value=w,w.length)r.value=w[w.length-1].url,g.value=r.value;else throw new Error("No playable video qualities available")}else if(t.main_url)M.value=[{label:"Auto",url:t.main_url}],r.value=t.main_url,g.value=t.main_url;else throw new Error("No video URL found")}catch(a){y.value=a.message}finally{_.value=!1,v.value&&s(2e3)}}function A(){o.value&&(k=o.value.currentTime,T=!o.value.paused,g.value=r.value,ae(()=>{o.value&&o.value.load()}),L())}function H(){o.value&&(k>0&&(o.value.currentTime=k),T&&o.value.play(),k=0,T=!1)}function Q(){V.value&&B()}function z(){if(!q.value)return;const e=i.episodes[c.value-1].vid;C(e)}function B(){if(!V.value)return;const e=i.episodes[c.value+1].vid;C(e)}function C(e){W("update:vid",e),L()}return(e,a)=>_.value?(p(),m("div",le,"Loading video...")):y.value?(p(),m("div",oe,"Error: "+h(y.value),1)):(p(),m("div",{key:2,class:"video-container",onMousemove:j},[E(l("div",{class:"episode-indicator-left",onMouseenter:b,onMouseleave:s},[a[1]||(a[1]=l("span",{class:"ep-text"},"Ep",-1)),a[2]||(a[2]=I()),l("span",ne,h(c.value+1),1)],544),[[D,u.value]]),E(l("div",{class:"nav-buttons",onMouseenter:b,onMouseleave:s},[l("button",{onClick:z,disabled:!q.value,class:"nav-btn"},"‹",8,se),l("span",ie,[a[3]||(a[3]=l("span",{class:"ep-label"},"Episode",-1)),I(" "+h(c.value+1)+" / "+h(U.episodes.length),1)]),l("button",{onClick:B,disabled:!V.value,class:"nav-btn"},"›",8,ue)],544),[[D,u.value]]),M.value.length>1?E((p(),m("div",{key:0,class:"quality-selector",onMouseenter:b,onMouseleave:s},[a[4]||(a[4]=l("label",{for:"quality"},"Quality:",-1)),E(l("select",{id:"quality","onUpdate:modelValue":a[0]||(a[0]=t=>r.value=t),onChange:A},[(p(!0),m(X,null,Z(M.value,t=>(p(),m("option",{key:t.label,value:t.url},h(t.label),9,re))),128))],544),[[$,r.value]])],544)),[[D,u.value]]):ee("",!0),l("video",{ref_key:"videoPlayer",ref:o,controls:"",autoplay:"",class:"video-player",onLoadedmetadata:H,onEnded:Q,onMouseenter:b,onMouseleave:s},[l("source",{src:g.value,type:"video/mp4"},null,8,de),a[5]||(a[5]=I(" Your browser does not support the video tag. ",-1))],544)],32))}},me=R(ve,[["__scopeId","data-v-0dbddb82"]]);export{me as W};
