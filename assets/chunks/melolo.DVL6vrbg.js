const n="https://melolo-api-azure.vercel.app/api",i=["https://api.codetabs.com/v1/proxy?quest=","https://thingproxy.freeboard.io/fetch/","https://api.allorigins.win/raw?url="];async function s(a,e={}){for(const t of i)try{let o,r;if(t.includes("allorigins")){if(o=`${t}${encodeURIComponent(a)}`,r=await fetch(o,e),!r.ok)throw new Error(`HTTP ${r.status}`);const c=await r.json();try{return JSON.parse(c.contents)}catch{return c.contents}}else{if(o=`${t}${a}`,r=await fetch(o,e),!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}}catch(o){console.warn(`Proxy ${t} failed:`,o)}throw new Error("All proxies failed")}function l(a){if(!a)return null;try{const e=a.replace(/\s/g,"");return atob(e)}catch{return null}}async function u(a=0){const e=`${n}/melolo/latest?offset=${a}`;return s(e)}async function d(a=0){const e=`${n}/melolo/trending?offset=${a}`;return s(e)}async function f(a,e=10,t=0){const o=`${n}/melolo/search?query=${encodeURIComponent(a)}&limit=${e}&offset=${t}`;return s(o)}async function p(a){const e=`${n}/melolo/detail/${a}`;return s(e)}async function m(a){const e=`${n}/melolo/stream/${a}`,t=await s(e);if(t.data?.main_url&&(t.data.main_url=l(t.data.main_url)),t.data?.backup_url&&(t.data.backup_url=l(t.data.backup_url)),t.data?.video_model)try{const o=JSON.parse(t.data.video_model);o.video_list&&Object.values(o.video_list).forEach(r=>{r.main_url&&(r.main_url=l(r.main_url)),r.backup_url_1&&(r.backup_url_1=l(r.backup_url_1))}),t.data.video_model=o}catch(o){console.warn("Failed to parse video_model",o)}return t}export{u as a,d as b,m as c,p as g,f as s};
