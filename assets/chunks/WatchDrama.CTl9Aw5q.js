import{_ as Y,p as J,s as K,z as X,o as p,c as m,t as _,ak as E,al as D,j as l,a as I,G as Z,H as $,ap as ee,e as ae,y as s,h as N,U as te}from"./framework.DVuO40We.js";import{c as le}from"./melolo.DVL6vrbg.js";const oe={key:0},se={key:1},ne={class:"ep-numbers"},ie=["disabled"],ue={class:"episode-indicator"},re=["disabled"],de=["value"],ve=["src"],ce={__name:"WatchDrama",props:{vid:{type:String,default:null},episodes:{type:Array,default:()=>[]}},emits:["update:vid"],setup(U,{expose:P,emit:W}){const i=U,A=W,y=s(!0),h=s(null),g=s(""),M=s([]),r=s(""),o=s(null),u=s(!0),d=s(null),v=s(!1);let k=0,T=!1;const c=N(()=>{const e=i.episodes.findIndex(a=>a.vid===i.vid);return e===-1?0:e}),q=N(()=>c.value>0),V=N(()=>c.value<i.episodes.length-1);J(()=>{v.value=window.matchMedia("(hover: hover)").matches,v.value?n(2e3):u.value=!0,S(i.vid)}),K(()=>{d.value&&clearTimeout(d.value)}),X(()=>i.vid,e=>{e&&S(e)});function b(){d.value&&(clearTimeout(d.value),d.value=null)}function n(e=2e3){v.value&&(b(),d.value=setTimeout(()=>{u.value=!1},e))}function L(){v.value&&(u.value=!0,n())}function H(){v.value&&(u.value=!0,n())}async function S(e){if(!e){h.value="No video ID provided",y.value=!1;return}y.value=!0,h.value=null;try{const t=(await le(e)).data||{};if(t.video_model&&t.video_model.video_list){const G=t.video_model.video_list,w=Object.entries(G).map(([x,f])=>({label:f.definition,url:f.main_url,quality:f.definition,bitrate:f.bitrate})).filter(x=>x.url).sort((x,f)=>{const O=parseInt(x.label)||0,R=parseInt(f.label)||0;return O-R});if(M.value=w,w.length)r.value=w[w.length-1].url,g.value=r.value;else throw new Error("No playable video qualities available")}else if(t.main_url)M.value=[{label:"Auto",url:t.main_url}],r.value=t.main_url,g.value=t.main_url;else throw new Error("No video URL found")}catch(a){h.value=a.message}finally{y.value=!1,v.value&&n(2e3)}}function Q(){o.value&&(k=o.value.currentTime,T=!o.value.paused,g.value=r.value,te(()=>{o.value&&o.value.load()}),L())}function j(){o.value&&(k>0&&(o.value.currentTime=k),T&&o.value.play(),k=0,T=!1)}function z(){V.value&&B()}function F(){if(!q.value)return;const e=i.episodes[c.value-1].vid;C(e)}function B(){if(!V.value)return;const e=i.episodes[c.value+1].vid;C(e)}function C(e){A("update:vid",e),L()}return P({loading:y}),(e,a)=>y.value?(p(),m("div",oe,"Loading video...")):h.value?(p(),m("div",se,"Error: "+_(h.value),1)):(p(),m("div",{key:2,class:"video-container",onMousemove:H},[E(l("div",{class:"episode-indicator-left",onMouseenter:b,onMouseleave:n},[a[1]||(a[1]=l("span",{class:"ep-text"},"Ep",-1)),a[2]||(a[2]=I()),l("span",ne,_(c.value+1),1)],544),[[D,u.value]]),E(l("div",{class:"nav-buttons",onMouseenter:b,onMouseleave:n},[l("button",{onClick:F,disabled:!q.value,class:"nav-btn"},"‹",8,ie),l("span",ue,[a[3]||(a[3]=l("span",{class:"ep-label"},"Episode",-1)),I(" "+_(c.value+1)+" / "+_(U.episodes.length),1)]),l("button",{onClick:B,disabled:!V.value,class:"nav-btn"},"›",8,re)],544),[[D,u.value]]),M.value.length>1?E((p(),m("div",{key:0,class:"quality-selector",onMouseenter:b,onMouseleave:n},[a[4]||(a[4]=l("label",{for:"quality"},"Quality:",-1)),E(l("select",{id:"quality","onUpdate:modelValue":a[0]||(a[0]=t=>r.value=t),onChange:Q},[(p(!0),m(Z,null,$(M.value,t=>(p(),m("option",{key:t.label,value:t.url},_(t.label),9,de))),128))],544),[[ee,r.value]])],544)),[[D,u.value]]):ae("",!0),l("video",{ref_key:"videoPlayer",ref:o,controls:"",autoplay:"",class:"video-player",onLoadedmetadata:j,onEnded:z,onMouseenter:b,onMouseleave:n},[l("source",{src:g.value,type:"video/mp4"},null,8,ve),a[5]||(a[5]=I(" Your browser does not support the video tag. ",-1))],544)],32))}},ye=Y(ce,[["__scopeId","data-v-83de3ff1"]]);export{ye as W};
