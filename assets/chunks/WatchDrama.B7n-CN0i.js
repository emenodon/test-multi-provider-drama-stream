import{_ as Z,P as $,p as ee,s as ae,z as j,o as y,c as b,t as x,ak as E,al as D,j as l,a as V,G as te,H as le,ap as oe,e as ne,a2 as A,y as s,h as I,U as se}from"./framework.DVuO40We.js";import{c as ue}from"./melolo.DVL6vrbg.js";import{d as ie}from"./theme.VUQj8b_9.js";const re={key:0},de={key:1},ve={class:"ep-numbers"},ce=["disabled"],fe={class:"episode-indicator"},pe=["disabled"],me=["value"],ye=["src"],be={__name:"WatchDrama",props:{vid:{type:String,default:null},episodes:{type:Array,default:()=>[]}},emits:["update:vid"],setup(N,{expose:H,emit:z}){const d=N,F=z,S=$(ie),h=s(!0),_=s(null),g=s(""),o=s([]),u=s(""),n=s(null),v=s(!0),c=s(null),f=s(!1);let w=0,T=!1;const p=I(()=>{const e=d.episodes.findIndex(a=>a.vid===d.vid);return e===-1?0:e}),q=I(()=>p.value>0),U=I(()=>p.value<d.episodes.length-1);ee(()=>{f.value=window.matchMedia("(hover: hover)").matches,f.value?i(2e3):v.value=!0,P(d.vid)}),ae(()=>{c.value&&clearTimeout(c.value)}),j(()=>d.vid,e=>{e&&P(e)});function C(){if(!o.value.length)return null;if(S.enabled.value){const e=o.value.find(a=>a.label==="360p");return e?e.url:o.value[0].url}else return o.value[o.value.length-1].url}function M(){c.value&&(clearTimeout(c.value),c.value=null)}function i(e=2e3){f.value&&(M(),c.value=setTimeout(()=>{v.value=!1},e))}function L(){f.value&&(v.value=!0,i())}function G(){f.value&&(v.value=!0,i())}async function P(e){if(!e){_.value="No video ID provided",h.value=!1;return}h.value=!0,_.value=null;try{const t=(await ue(e)).data||{};if(t.video_model&&t.video_model.video_list){const Y=t.video_model.video_list,k=Object.entries(Y).map(([r,m])=>({label:m.definition,url:m.main_url,quality:m.definition,bitrate:m.bitrate})).filter(r=>r.url).sort((r,m)=>{const J=parseInt(r.label)||0,X=parseInt(m.label)||0;return J-X});if(k.length){o.value=k;const r=C();r?(u.value=r,g.value=r):(u.value=k[0].url,g.value=k[0].url)}else throw new Error("No playable video qualities available")}else if(t.main_url)o.value=[{label:"Auto",url:t.main_url}],u.value=t.main_url,g.value=t.main_url;else throw new Error("No video URL found")}catch(a){_.value=a.message}finally{h.value=!1,f.value&&i(2e3)}}function B(){n.value&&(w=n.value.currentTime,T=!n.value.paused,g.value=u.value,se(()=>{n.value&&n.value.load()}),L())}j(()=>S.enabled.value,()=>{if(o.value.length){const e=C();e&&e!==u.value&&(u.value=e,B())}});function K(){n.value&&(w>0&&(n.value.currentTime=w),T&&n.value.play(),w=0,T=!1)}function O(){U.value&&Q()}function R(){if(!q.value)return;const e=d.episodes[p.value-1].vid;W(e)}function Q(){if(!U.value)return;const e=d.episodes[p.value+1].vid;W(e)}function W(e){F("update:vid",e),L()}return H({loading:h}),(e,a)=>h.value?(y(),b("div",re,"Loading video...")):_.value?(y(),b("div",de,"Error: "+x(_.value),1)):(y(),b("div",{key:2,class:"video-container",onMousemove:G,onContextmenu:a[2]||(a[2]=A(()=>{},["prevent"]))},[E(l("div",{class:"episode-indicator-left",onMouseenter:M,onMouseleave:i},[a[3]||(a[3]=l("span",{class:"ep-text"},"Ep",-1)),a[4]||(a[4]=V()),l("span",ve,x(p.value+1),1)],544),[[D,v.value]]),E(l("div",{class:"nav-buttons",onMouseenter:M,onMouseleave:i},[l("button",{onClick:R,disabled:!q.value,class:"nav-btn"},"‹",8,ce),l("span",fe,[a[5]||(a[5]=l("span",{class:"ep-label"},"Episode",-1)),V(" "+x(p.value+1)+" / "+x(N.episodes.length),1)]),l("button",{onClick:Q,disabled:!U.value,class:"nav-btn"},"›",8,pe)],544),[[D,v.value]]),o.value.length>1?E((y(),b("div",{key:0,class:"quality-selector",onMouseenter:M,onMouseleave:i},[a[6]||(a[6]=l("label",{for:"quality"},"Quality:",-1)),E(l("select",{id:"quality","onUpdate:modelValue":a[0]||(a[0]=t=>u.value=t),onChange:B},[(y(!0),b(te,null,le(o.value,t=>(y(),b("option",{key:t.label,value:t.url},x(t.label),9,me))),128))],544),[[oe,u.value]])],544)),[[D,v.value]]):ne("",!0),l("video",{ref_key:"videoPlayer",ref:n,controls:"",autoplay:"",class:"video-player",onLoadedmetadata:K,onEnded:O,onMouseenter:M,onMouseleave:i,onContextmenu:a[1]||(a[1]=A(()=>{},["prevent"]))},[l("source",{src:g.value,type:"video/mp4"},null,8,ye),a[7]||(a[7]=V(" Your browser does not support the video tag. ",-1))],544)],32))}},xe=Z(be,[["__scopeId","data-v-177acb74"]]);export{xe as W};
