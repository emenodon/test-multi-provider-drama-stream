import{_ as J,p as U,U as x,s as K,z as P,o as n,c as o,j as s,ak as j,ao as G,a0 as L,a as p,t as Q,J as I,e as M,G as R,y as l}from"./chunks/framework.DVuO40We.js";import{s as z}from"./chunks/melolo.DVL6vrbg.js";import{D as A}from"./chunks/theme.C8xOwrk0.js";const Y={class:"search-form"},$={class:"search-input-wrapper"},H=["disabled"],W={key:0,class:"fas fa-spinner fa-spin"},X={key:1,class:"fas fa-search"},Z={key:0,class:"loading-state"},ee={key:1,class:"error-state"},ae={key:2},se={key:0,class:"loading-more"},te={key:1,class:"no-more"},T="drama-search-state",re={__name:"SearchForm",setup(N){const t=l(""),a=l([]),r=l(!1),f=l(!1),_=l(null),u=l(!0),v=l(0),y=l(!1),g=l(null);let c=null,b=null,d=null,m=!1;U(()=>{b=document.querySelector(".vp-doc"),V(),x(D)}),K(()=>{c&&c.disconnect(),d&&clearTimeout(d)});function F(){sessionStorage.setItem(T,JSON.stringify({query:t.value,results:a.value,hasMore:u.value,nextOffset:v.value,searched:y.value}))}function V(){const i=sessionStorage.getItem(T);if(i)try{const e=JSON.parse(i);t.value=e.query||"",a.value=e.results||[],u.value=e.hasMore??!0,v.value=e.nextOffset||0,y.value=e.searched||!1}catch(e){console.warn("Failed to restore search state",e)}}function D(){g.value&&(c&&c.disconnect(),c=new IntersectionObserver(i=>{i[0].isIntersecting&&u.value&&!r.value&&!f.value&&!m&&B()},{root:null,rootMargin:"400px 0px",threshold:0}),c.observe(g.value))}function q(){if(d&&clearTimeout(d),!t.value.trim()){a.value=[],u.value=!1;return}d=setTimeout(S,350)}function S(){!t.value.trim()||r.value||(b?.scrollTo({top:0,behavior:"auto"}),O(0,!1))}async function O(i=0,e=!1){if(!(e&&m)&&!(!e&&r.value)){e?(f.value=!0,m=!0):(r.value=!0,a.value=[],u.value=!0,v.value=0),_.value=null,y.value=!0;try{const h=t.value.trim(),C=encodeURIComponent(h),k=await z(C,6,i),w=(k.data?.search_data||[]).flatMap(E=>E.books||[]);e?a.value.push(...w):a.value=w,u.value=k.data?.has_more||!1,v.value=k.data?.next_offset||0}catch(h){_.value=h.message}finally{r.value=!1,f.value=!1,m=!1,F(),await x()}}}function B(){!u.value||r.value||f.value||m||O(v.value,!0)}return P(g,()=>{x(D)}),(i,e)=>(n(),o(R,null,[s("div",Y,[s("div",$,[e[1]||(e[1]=s("i",{class:"fas fa-search search-icon"},null,-1)),j(s("input",{"onUpdate:modelValue":e[0]||(e[0]=h=>t.value=h),onInput:q,onKeyup:L(S,["enter"]),placeholder:"Search dramas..."},null,544),[[G,t.value]])]),s("button",{onClick:S,disabled:r.value||!t.value.trim()},[r.value?(n(),o("i",W)):(n(),o("i",X)),e[2]||(e[2]=s("span",{class:"search-text"},"Search",-1))],8,H)]),r.value&&!a.value.length?(n(),o("div",Z,[...e[3]||(e[3]=[s("i",{class:"fas fa-spinner fa-spin"},null,-1),p(" Searching... ",-1)])])):_.value&&!a.value.length?(n(),o("div",ee,[e[4]||(e[4]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),p(" Error: "+Q(_.value),1)])):(n(),o("div",ae,[I(A,{dramas:a.value},null,8,["dramas"]),s("div",{ref_key:"sentinel",ref:g,class:"sentinel"},null,512),f.value?(n(),o("div",se,[...e[5]||(e[5]=[s("i",{class:"fas fa-spinner fa-spin"},null,-1),p(" Loading more... ",-1)])])):M("",!0),!u.value&&a.value.length?(n(),o("div",te,[...e[6]||(e[6]=[s("i",{class:"fas fa-check-circle"},null,-1),p(" No more results ",-1)])])):M("",!0)]))],64))}},le=J(re,[["__scopeId","data-v-8f08ff38"]]),fe=JSON.parse('{"title":"Search Dramas","description":"","frontmatter":{"title":"Search Dramas"},"headers":[],"relativePath":"search.md","filePath":"search.md"}'),ne={name:"search.md"},ve=Object.assign(ne,{setup(N){return(t,a)=>(n(),o("div",null,[a[0]||(a[0]=s("h1",{id:"search-dramas",tabindex:"-1"},[p("Search Dramas "),s("a",{class:"header-anchor",href:"#search-dramas","aria-label":"Permalink to “Search Dramas”"},"​")],-1)),I(le)]))}});export{fe as __pageData,ve as default};
