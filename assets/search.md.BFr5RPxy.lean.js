import{_ as V,p as B,z as E,s as F,o as l,c as n,j as a,aj as J,an as j,a0 as q,a as m,t as K,J as b,e as x,G as P,y as r,U}from"./chunks/framework.DkZ_CT3H.js";import{s as C}from"./chunks/melolo.DVL6vrbg.js";import{D as G}from"./chunks/theme.DS-3Z2AH.js";const L={class:"search-form"},z={class:"search-input-wrapper"},A=["disabled"],R={key:0,class:"fas fa-spinner fa-spin"},Y={key:1,class:"fas fa-search"},$={key:0,class:"loading-state"},H={key:1,class:"error-state"},Q={key:2},W={key:0,class:"loading-more"},X={key:1,class:"no-more"},D="drama-search-state",Z={__name:"SearchForm",setup(O){const o=r(""),s=r([]),d=r(!1),f=r(!1),p=r(null),i=r(!0),v=r(0),g=r(!1),_=r(null);let c=null,h=null;B(()=>{const t=sessionStorage.getItem(D);if(t)try{const e=JSON.parse(t);o.value=e.query||"",s.value=e.results||[],i.value=e.hasMore!==void 0?e.hasMore:!0,v.value=e.nextOffset||0,g.value=e.searched||!1}catch(e){console.warn("Failed to restore search state",e)}});function w(){const t={query:o.value,results:s.value,hasMore:i.value,nextOffset:v.value,searched:g.value};sessionStorage.setItem(D,JSON.stringify(t))}function M(){c&&c.disconnect(),_.value&&(c=new IntersectionObserver(t=>{t[0].isIntersecting&&i.value&&!f.value&&T()},{threshold:.1}),c.observe(_.value))}E(_,t=>{t&&U(M)},{immediate:!0}),F(()=>{c&&c.disconnect(),h&&clearTimeout(h)});function N(){h&&clearTimeout(h),h=setTimeout(()=>{y()},300)}async function y(){o.value.trim()&&await S(0,!1)}async function S(t=0,e=!1){e?f.value=!0:(d.value=!0,s.value=[],i.value=!0,v.value=0),p.value=null,g.value=!0;try{const u=await C(o.value,10,t),k=(u.data?.search_data||[]).flatMap(I=>I.books||[]);e?s.value.push(...k):s.value=k,i.value=u.data?.has_more||!1,v.value=u.data?.next_offset||0}catch(u){p.value=u.message}finally{d.value=!1,f.value=!1,w()}}const T=()=>{!i.value||f.value||S(v.value,!0)};return(t,e)=>(l(),n(P,null,[a("div",L,[a("div",z,[e[1]||(e[1]=a("i",{class:"fas fa-search search-icon"},null,-1)),J(a("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>o.value=u),onInput:N,onKeyup:q(y,["enter"]),placeholder:"Search dramas..."},null,544),[[j,o.value]])]),a("button",{onClick:y,disabled:d.value||!o.value.trim()},[d.value?(l(),n("i",R)):(l(),n("i",Y)),e[2]||(e[2]=a("span",{class:"search-text"},"Search",-1))],8,A)]),d.value&&!s.value.length?(l(),n("div",$,[...e[3]||(e[3]=[a("i",{class:"fas fa-spinner fa-spin"},null,-1),m(" Searching... ",-1)])])):p.value&&!s.value.length?(l(),n("div",H,[e[4]||(e[4]=a("i",{class:"fas fa-exclamation-circle"},null,-1)),m(" Error: "+K(p.value),1)])):(l(),n("div",Q,[b(G,{dramas:s.value},null,8,["dramas"]),a("div",{ref_key:"sentinel",ref:_,class:"sentinel"},null,512),f.value?(l(),n("div",W,[...e[5]||(e[5]=[a("i",{class:"fas fa-spinner fa-spin"},null,-1),m(" Loading more... ",-1)])])):x("",!0),!i.value&&s.value.length?(l(),n("div",X,[...e[6]||(e[6]=[a("i",{class:"fas fa-check-circle"},null,-1),m(" No more results ",-1)])])):x("",!0)]))],64))}},ee=V(Z,[["__scopeId","data-v-eafc2074"]]),ne=JSON.parse('{"title":"Search Dramas","description":"","frontmatter":{"title":"Search Dramas"},"headers":[],"relativePath":"search.md","filePath":"search.md"}'),ae={name:"search.md"},oe=Object.assign(ae,{setup(O){return(o,s)=>(l(),n("div",null,[s[0]||(s[0]=a("h1",{id:"search-dramas",tabindex:"-1"},[m("Search Dramas "),a("a",{class:"header-anchor",href:"#search-dramas","aria-label":"Permalink to “Search Dramas”"},"​")],-1)),b(ee)]))}});export{ne as __pageData,oe as default};
