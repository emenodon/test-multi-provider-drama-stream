import{_ as B,p as E,z as F,s as J,o as n,c as o,j as a,aj as j,an as q,a0 as K,a as p,t as P,J as w,e as k,G as U,y as l,U as x}from"./chunks/framework.DkZ_CT3H.js";import{s as C}from"./chunks/melolo.DVL6vrbg.js";import{D as G}from"./chunks/theme.Dq71D3bh.js";const L={class:"search-form"},z={class:"search-input-wrapper"},A=["disabled"],R={key:0,class:"fas fa-spinner fa-spin"},Y={key:1,class:"fas fa-search"},$={key:0,class:"loading-state"},H={key:1,class:"error-state"},Q={key:2},W={key:0,class:"loading-more"},X={key:1,class:"no-more"},D="drama-search-state",Z={__name:"SearchForm",setup(M){const u=l(""),s=l([]),i=l(!1),f=l(!1),_=l(null),c=l(!0),h=l(0),g=l(!1),d=l(null);let r=null,m=null;E(()=>{const t=sessionStorage.getItem(D);if(t)try{const e=JSON.parse(t);u.value=e.query||"",s.value=e.results||[],c.value=e.hasMore!==void 0?e.hasMore:!0,h.value=e.nextOffset||0,g.value=e.searched||!1}catch(e){console.warn("Failed to restore search state",e)}});function O(){const t={query:u.value,results:s.value,hasMore:c.value,nextOffset:h.value,searched:g.value};sessionStorage.setItem(D,JSON.stringify(t))}function T(){r&&r.disconnect(),d.value&&(r=new IntersectionObserver(t=>{t[0].isIntersecting&&c.value&&!f.value&&!i.value&&I()},{root:null,rootMargin:"600px 0px",threshold:0}),r.observe(d.value))}F(d,t=>{t&&x(T)},{immediate:!0}),J(()=>{r&&r.disconnect(),m&&clearTimeout(m)});function N(){m&&clearTimeout(m),m=setTimeout(()=>{y()},300)}function y(){!u.value.trim()||i.value||(window.scrollTo({top:0,behavior:"auto"}),S(0,!1))}async function S(t=0,e=!1){e?f.value=!0:(i.value=!0,s.value=[],c.value=!0,h.value=0),_.value=null,g.value=!0;try{const v=await C(u.value,6,t),b=(v.data?.search_data||[]).flatMap(V=>V.books||[]);e?s.value.push(...b):s.value=b,c.value=v.data?.has_more||!1,h.value=v.data?.next_offset||0}catch(v){_.value=v.message}finally{i.value=!1,f.value=!1,O(),x(()=>{r&&d.value&&r.observe(d.value)})}}const I=()=>{!c.value||f.value||i.value||(r&&r.unobserve(d.value),S(h.value,!0))};return(t,e)=>(n(),o(U,null,[a("div",L,[a("div",z,[e[1]||(e[1]=a("i",{class:"fas fa-search search-icon"},null,-1)),j(a("input",{"onUpdate:modelValue":e[0]||(e[0]=v=>u.value=v),onInput:N,onKeyup:K(y,["enter"]),placeholder:"Search dramas..."},null,544),[[q,u.value]])]),a("button",{onClick:y,disabled:i.value||!u.value.trim()},[i.value?(n(),o("i",R)):(n(),o("i",Y)),e[2]||(e[2]=a("span",{class:"search-text"},"Search",-1))],8,A)]),i.value&&!s.value.length?(n(),o("div",$,[...e[3]||(e[3]=[a("i",{class:"fas fa-spinner fa-spin"},null,-1),p(" Searching... ",-1)])])):_.value&&!s.value.length?(n(),o("div",H,[e[4]||(e[4]=a("i",{class:"fas fa-exclamation-circle"},null,-1)),p(" Error: "+P(_.value),1)])):(n(),o("div",Q,[w(G,{dramas:s.value},null,8,["dramas"]),a("div",{ref_key:"sentinel",ref:d,class:"sentinel"},null,512),f.value?(n(),o("div",W,[...e[5]||(e[5]=[a("i",{class:"fas fa-spinner fa-spin"},null,-1),p(" Loading more... ",-1)])])):k("",!0),!c.value&&s.value.length?(n(),o("div",X,[...e[6]||(e[6]=[a("i",{class:"fas fa-check-circle"},null,-1),p(" No more results ",-1)])])):k("",!0)]))],64))}},ee=B(Z,[["__scopeId","data-v-db35fd3b"]]),ne=JSON.parse('{"title":"Search Dramas","description":"","frontmatter":{"title":"Search Dramas"},"headers":[],"relativePath":"search.md","filePath":"search.md"}'),ae={name:"search.md"},oe=Object.assign(ae,{setup(M){return(u,s)=>(n(),o("div",null,[s[0]||(s[0]=a("h1",{id:"search-dramas",tabindex:"-1"},[p("Search Dramas "),a("a",{class:"header-anchor",href:"#search-dramas","aria-label":"Permalink to “Search Dramas”"},"​")],-1)),w(ee)]))}});export{ne as __pageData,oe as default};
