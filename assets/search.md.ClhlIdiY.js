import{_ as E,p as J,U as k,s as C,z as K,o as n,c as o,j as s,al as P,ap as U,a0 as j,a as p,t as G,J as T,e as w,G as L,y as l}from"./chunks/framework.DzV2409W.js";import{s as z}from"./chunks/melolo.DVL6vrbg.js";import{D as A}from"./chunks/theme.D6A7_2qu.js";const R={class:"search-form"},Y={class:"search-input-wrapper"},$=["disabled"],H={key:0,class:"fas fa-spinner fa-spin"},Q={key:1,class:"fas fa-search"},W={key:0,class:"loading-state"},X={key:1,class:"error-state"},Z={key:2},ee={key:0,class:"loading-more"},ae={key:1,class:"no-more"},M="drama-search-state",se={__name:"SearchForm",setup(N){const t=l(""),a=l([]),r=l(!1),v=l(!1),_=l(null),u=l(!0),d=l(0),y=l(!1),g=l(null);let f=null,x=null,h=null,m=!1;J(()=>{x=document.querySelector(".vp-doc"),F(),k(b)}),C(()=>{f&&f.disconnect(),h&&clearTimeout(h)});function I(){sessionStorage.setItem(M,JSON.stringify({query:t.value,results:a.value,hasMore:u.value,nextOffset:d.value,searched:y.value}))}function F(){const i=sessionStorage.getItem(M);if(i)try{const e=JSON.parse(i);t.value=e.query||"",a.value=e.results||[],u.value=e.hasMore??!0,d.value=e.nextOffset||0,y.value=e.searched||!1}catch(e){console.warn("Failed to restore search state",e)}}function b(){g.value&&(f&&f.disconnect(),f=new IntersectionObserver(i=>{i[0].isIntersecting&&u.value&&!r.value&&!v.value&&!m&&q()},{root:null,rootMargin:"400px 0px",threshold:0}),f.observe(g.value))}function V(){if(h&&clearTimeout(h),!t.value.trim()){a.value=[],u.value=!1;return}h=setTimeout(S,350)}function S(){!t.value.trim()||r.value||(x?.scrollTo({top:0,behavior:"auto"}),D(0,!1))}async function D(i=0,e=!1){if(!(e&&m)&&!(!e&&r.value)){e?(v.value=!0,m=!0):(r.value=!0,a.value=[],u.value=!0,d.value=0),_.value=null,y.value=!0;try{const c=await z(t.value,6,i),O=(c.data?.search_data||[]).flatMap(B=>B.books||[]);e?a.value.push(...O):a.value=O,u.value=c.data?.has_more||!1,d.value=c.data?.next_offset||0}catch(c){_.value=c.message}finally{r.value=!1,v.value=!1,m=!1,I(),await k()}}}function q(){!u.value||r.value||v.value||m||D(d.value,!0)}return K(g,()=>{k(b)}),(i,e)=>(n(),o(L,null,[s("div",R,[s("div",Y,[e[1]||(e[1]=s("i",{class:"fas fa-search search-icon"},null,-1)),P(s("input",{"onUpdate:modelValue":e[0]||(e[0]=c=>t.value=c),onInput:V,onKeyup:j(S,["enter"]),placeholder:"Search dramas..."},null,544),[[U,t.value]])]),s("button",{onClick:S,disabled:r.value||!t.value.trim()},[r.value?(n(),o("i",H)):(n(),o("i",Q)),e[2]||(e[2]=s("span",{class:"search-text"},"Search",-1))],8,$)]),r.value&&!a.value.length?(n(),o("div",W,[...e[3]||(e[3]=[s("i",{class:"fas fa-spinner fa-spin"},null,-1),p(" Searching... ",-1)])])):_.value&&!a.value.length?(n(),o("div",X,[e[4]||(e[4]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),p(" Error: "+G(_.value),1)])):(n(),o("div",Z,[T(A,{dramas:a.value},null,8,["dramas"]),s("div",{ref_key:"sentinel",ref:g,class:"sentinel"},null,512),v.value?(n(),o("div",ee,[...e[5]||(e[5]=[s("i",{class:"fas fa-spinner fa-spin"},null,-1),p(" Loading more... ",-1)])])):w("",!0),!u.value&&a.value.length?(n(),o("div",ae,[...e[6]||(e[6]=[s("i",{class:"fas fa-check-circle"},null,-1),p(" No more results ",-1)])])):w("",!0)]))],64))}},te=E(se,[["__scopeId","data-v-9021631a"]]),ie=JSON.parse('{"title":"Search Dramas","description":"","frontmatter":{"title":"Search Dramas"},"headers":[],"relativePath":"search.md","filePath":"search.md"}'),re={name:"search.md"},ce=Object.assign(re,{setup(N){return(t,a)=>(n(),o("div",null,[a[0]||(a[0]=s("h1",{id:"search-dramas",tabindex:"-1"},[p("Search Dramas "),s("a",{class:"header-anchor",href:"#search-dramas","aria-label":"Permalink to “Search Dramas”"},"​")],-1)),T(te)]))}});export{ie as __pageData,ce as default};
