import{_ as J,p as j,U as x,s as C,z as K,o as i,c as u,j as s,aj as L,an as P,a0 as U,a as g,t as G,J as I,e as O,G as z,y as o}from"./chunks/framework.DkZ_CT3H.js";import{s as A}from"./chunks/melolo.DVL6vrbg.js";import{D as H}from"./chunks/theme.Dq71D3bh.js";const R={class:"search-form"},Y={class:"search-input-wrapper"},$=["disabled"],Q={key:0,class:"fas fa-spinner fa-spin"},W={key:1,class:"fas fa-search"},X={key:0,class:"loading-state"},Z={key:1,class:"error-state"},ee={key:2},ae={key:0,class:"loading-more"},se={key:1,class:"no-more"},w="drama-search-state",te={__name:"SearchForm",setup(N){const t=o(""),a=o([]),r=o(!1),m=o(!1),y=o(null),l=o(!0),p=o(0),S=o(!1),d=o(null);let h=null,f=null,_=null,v=!1;j(()=>{f=document.querySelector(".vp-doc"),B(),x(b)}),C(()=>{h&&h.disconnect(),_&&clearTimeout(_)});function V(){sessionStorage.setItem(w,JSON.stringify({query:t.value,results:a.value,hasMore:l.value,nextOffset:p.value,searched:S.value}))}function B(){const n=sessionStorage.getItem(w);if(n)try{const e=JSON.parse(n);t.value=e.query||"",a.value=e.results||[],l.value=e.hasMore??!0,p.value=e.nextOffset||0,S.value=e.searched||!1}catch(e){console.warn("Failed to restore search state",e)}}function b(){!d.value||!f||(h&&h.disconnect(),h=new IntersectionObserver(n=>{n[0].isIntersecting&&l.value&&!r.value&&!m.value&&!v&&D()},{root:f,rootMargin:"400px 0px",threshold:0}),h.observe(d.value))}function F(){if(_&&clearTimeout(_),!t.value.trim()){a.value=[],l.value=!1;return}_=setTimeout(k,350)}function k(){!t.value.trim()||r.value||(f?.scrollTo({top:0,behavior:"auto"}),T(0,!1))}async function T(n=0,e=!1){if(!(!e&&r.value)&&!(e&&v)){e?(m.value=!0,v=!0):(r.value=!0,v=!1,a.value=[],l.value=!0,p.value=0),y.value=null,S.value=!0;try{const c=await A(t.value,6,n),M=(c.data?.search_data||[]).flatMap(E=>E.books||[]);e?a.value.push(...M):a.value=M,l.value=c.data?.has_more||!1,p.value=c.data?.next_offset||0}catch(c){y.value=c.message}finally{r.value=!1,m.value=!1,v=!1,V(),await x(),q()}}}function D(){!l.value||r.value||m.value||v||T(p.value,!0)}function q(){if(!f||!d.value||v)return;const n=f.scrollTop+f.clientHeight;d.value.offsetTop-n<400&&l.value&&D()}return K(d,()=>{x(b)}),(n,e)=>(i(),u(z,null,[s("div",R,[s("div",Y,[e[1]||(e[1]=s("i",{class:"fas fa-search search-icon"},null,-1)),L(s("input",{"onUpdate:modelValue":e[0]||(e[0]=c=>t.value=c),onInput:F,onKeyup:U(k,["enter"]),placeholder:"Search dramas..."},null,544),[[P,t.value]])]),s("button",{onClick:k,disabled:r.value||!t.value.trim()},[r.value?(i(),u("i",Q)):(i(),u("i",W)),e[2]||(e[2]=s("span",{class:"search-text"},"Search",-1))],8,$)]),r.value&&!a.value.length?(i(),u("div",X,[...e[3]||(e[3]=[s("i",{class:"fas fa-spinner fa-spin"},null,-1),g(" Searching... ",-1)])])):y.value&&!a.value.length?(i(),u("div",Z,[e[4]||(e[4]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),g(" Error: "+G(y.value),1)])):(i(),u("div",ee,[I(H,{dramas:a.value},null,8,["dramas"]),s("div",{ref_key:"sentinel",ref:d,class:"sentinel"},null,512),m.value?(i(),u("div",ae,[...e[5]||(e[5]=[s("i",{class:"fas fa-spinner fa-spin"},null,-1),g(" Loading more... ",-1)])])):O("",!0),!l.value&&a.value.length?(i(),u("div",se,[...e[6]||(e[6]=[s("i",{class:"fas fa-check-circle"},null,-1),g(" No more results ",-1)])])):O("",!0)]))],64))}},re=J(te,[["__scopeId","data-v-dd6ce896"]]),ce=JSON.parse('{"title":"Search Dramas","description":"","frontmatter":{"title":"Search Dramas"},"headers":[],"relativePath":"search.md","filePath":"search.md"}'),le={name:"search.md"},fe=Object.assign(le,{setup(N){return(t,a)=>(i(),u("div",null,[a[0]||(a[0]=s("h1",{id:"search-dramas",tabindex:"-1"},[g("Search Dramas "),s("a",{class:"header-anchor",href:"#search-dramas","aria-label":"Permalink to “Search Dramas”"},"​")],-1)),I(re)]))}});export{ce as __pageData,fe as default};
